<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record model="ir.ui.view" id="mrp_workorder_moves_search">
        <field name="name">mrp.workorder.moves.form</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.stock_move_line_view_search" />
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='groupby_product_id']" position="after">
                <filter name="groupby_lot_produced_id" domain="[]" context="{'group_by': 'lot_produced_id'}"  />
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="workorder_stock_move_form">
        <field name="name">workorder.stock.move.form</field>
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp.mrp_production_workorder_form_view_inherit"/>
        <field name="arch" type="xml">
<!--            <button name="record_production" position="after">
                <button name="button_execute_all_moves" type="object" string="Do All" class="btn-success" attrs="{'invisible': ['|', '|', '|', ('is_produced', '=', True), ('working_state', '=', 'blocked'), ('state', '!=', 'progress'), ('is_user_working', '=', False)]}"/>
                <button name="button_create_all_moves" type="object" string="Create all moves" class="btn-success" attrs="{'invisible': ['|', '|', '|', ('is_produced', '=', True), ('working_state', '=', 'blocked'), ('state', '!=', 'progress'), ('is_user_working', '=', False)]}"/>
            </button>-->
            <button name="action_see_move_scrap"
                    position="after">
                <button class="oe_stat_button" name="button_open_active_move_lines" type="object" string="Moves" icon="fa-arrows-v">
                    <!--<field string="Survey Responses" name="user_input_count"
                           widget="statinfo" />-->
                </button>
                <button class="oe_stat_button" name="button_open_lots" type="object" string="Lots" icon="fa-arrows-v" context="{'moves_workorder_id': active_id}">
                    <!--<field string="Survey Responses" name="user_input_count"
                           widget="statinfo" />-->
                </button>
            </button>
            <xpath expr="//field[@name='move_raw_ids']" position="attributes">
                <attribute name="invisible"/>
                <attribute name="attrs">{'invisible': [('move_raw_ids', '=', [])]}</attribute>
            </xpath>
            <xpath expr="//field[@name='active_move_line_ids']/tree/field[@name='lot_id']" position="after">
                <field name="lot_produced_id"/>
            </xpath>
            <xpath expr="//field[@name='move_raw_ids']" position="after">
                <field name="move_line_ids" attrs="{'invisible': [('move_line_ids', '=', [])]}">
                    <tree editable="bottom" create="0" delete="0">
                        <field name="product_id"/>
                        <field name="product_uom_qty" readonly="1" invisible="1" string="To Consume"/>
                        <field name="lot_id" domain="[('product_id', '=', product_id)]"
                               context="{'default_product_id': product_id}"/>
                        <field name="lot_produced_id"/>
                        <field name="qty_done"/>
                        <field name="product_uom_id" invisible="1"/>
                        <field name="location_id" invisible="1"/>
                        <field name="location_dest_id" invisible="1"/>
                        <field name="move_id" invisible="1"/>
                        <field name="done_wo" invisible="1"/>
                    </tree>
                </field>
            </xpath>
        </field>
    </record>
</odoo>
